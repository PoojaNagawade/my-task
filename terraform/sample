terraform {
 required_providers {
        aws = {
        source  = "hashicorp/aws"
        version = "~> 4.16"
}
}
        required_version = ">= 1.2.0"
}


provider "aws" {
region = "us-east-2"
}


resource "aws_key_pair" "key" {
  key_name   = "id_rsa1" 
  public_key = file("~/.ssh/id_rsa.pub")
}


resource "aws_instance" "aws_ec2_test" {
        ami = "ami-0b8b44ec9a8f90422"
        instance_type = "t2.micro"
        # refering key which we created earlier
        key_name = aws_key_pair.key.key_name
        # iam_instance_profile = aws_iam_role.ec2_role.name
security_groups = [aws_security_group.instance.name]
        tags = {
        Name = "TerraformTestServerInstance"
               }
}

resource "aws_security_group" "instance" {
  name        = "instance-security-group"
  description = "Security group for EC2 instance"

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]  # Allow SSH access from anywhere (adjust as needed)
  }
}

# Create an S3 bucket


resource "aws_s3_bucket" "jenkins_bucket" {
  bucket = "my-jenkins-bucket-azul1"  # Replace with your desired bucket name
 # acl    = "public-read"         # Set the ACL to make the bucket publicly readable

  tags = {
    Name = "my-jenkins-bucket"
  }
}
